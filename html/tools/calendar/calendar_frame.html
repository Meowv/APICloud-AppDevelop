<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>calendar_frame</title>
    <link rel="stylesheet" href="../../../css/aui.css">
    <link rel="stylesheet" href="../../../css/swiper.min.css">
    <link rel="stylesheet" href="lib/css/calendar.css">
</head>

<body>
    <div class="loading loading1 covers">
        <div class="loading-bj"></div>
        <p>加载中...</p>
    </div>
    <section class="out-wrap">
        <div class="header-main">
            <section class="day">
                <section class="grid clearfix">
                    <div class="day-left clearfix">
                        <h1 id="top_shu">20</h1>
                        <div class="top-contrl">
                            <p>
                                <em id="top_week">星期二</em>
                            </p>
                            <div>
                                <i id="top_yue">八月廿十</i>
                            </div>
                        </div>
                    </div>
                    <div class="day-right clearfix">
                        <section class="header">
                            <div class="child date">
                                <em class="f34" id="ymym">2016年06月</em>
                                <i></i>
                            </div>
                            <div class="child listdetail" onclick="search()">
                                <em>详细信息 </em><i></i>
                            </div>
                        </section>
                        <div class="yun">
                            <span class="js_jin">今</span>
                        </div>
                    </div>
                </section>
            </section>
            <div class="display" id="dis">
                <section class="yeardetail">
                    <div class="yearwidth" id="lunarYear">
                        XX年
                    </div>
                    <div class="yearwidth" id="animalsYear">
                        猴
                    </div>
                    <div class="yearwidth" id="holiday"></div>
                </section>
                <section class="headdetail">
                    <div class="head-left" id="suit">
                        宜：
                    </div>
                    <div class="head-right" id="avoid">
                        忌：
                    </div>
                </section>
                <section class="headdetail"></section>
            </div>
            <!-- end day -->
        </div>
        <!-- end header -->
        <section class="content">
            <section class="week">
                <ul class="clearfix f28">
                    <li>
                        <a href="#">日</a>
                    </li>
                    <li>
                        <a href="#">一</a>
                    </li>
                    <li>
                        <a href="#">二</a>
                    </li>
                    <li>
                        <a href="#">三</a>
                    </li>
                    <li>
                        <a href="#">四</a>
                    </li>
                    <li>
                        <a href="#">五</a>
                    </li>
                    <li>
                        <a href="#">六</a>
                    </li>
                </ul>
            </section>
            <section class="calenda">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <table id="now1" class="tables">
                                <tr class="">
                                    <td class=" list"><i>12</i><em>中秋</em></td>
                                </tr>
                            </table>
                        </div>
                        <div class="swiper-slide">
                            <table id="now2" class="tables">
                                <tr class="">
                                    <td class=" list"><i>12</i><em>中秋</em></td>
                                    <td class=" list"><i>12</i><em>中秋</em></td>
                                    <td class=" list"><i>12</i><em>中秋</em></td>
                                    <td class=" list"><i>12</i><em>中秋</em></td>
                                    <td class=" list"><i>12</i><em>中秋</em></td>
                                    <td class=" list"><i>12</i><em>中秋</em></td>
                                    <td class=" list"><i>12</i><em>中秋</em></td>
                                </tr>
                            </table>
                        </div>
                        <div class="swiper-slide">
                            <table id="now3" class="tables">
                                <tr class="">
                                    <td class="list"><i>12</i><em>中秋</em></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            <!-- end calenda -->
        </section>
        <!-- end content -->
        <section class="prorup"></section>
        <!-- 弹窗 -->
        <div class="tc"></div>
        <div class="tc-innner">
            <h2>选择日期 </h2>
            <div class="current-time">
                <i class="i-year">1900年</i><i class="i-month">1月</i>
            </div>
            <div class="swiper-box">
                <i class="i1"></i>
                <i class="i2"></i>
                <i class="i3"></i>
                <div class="swiper-box-li">
                    <div class="swiper-container2 nbxs">
                        <div class="swiper-wrapper year" id='arrays'>
                            <script id="arraystmpl" type="text/x-dot-template">
                                {{~it.array:value:index}}
                                <div class="swiper-slide">{{= value }}年</div>
                                {{~}}
                            </script>
                        </div>
                    </div>
                </div>
                <div class="swiper-box-li">
                    <div class="swiper-container3 nbxs">
                        <div class="swiper-wrapper month">
                            <div class="swiper-slide">
                                1月
                            </div>
                            <div class="swiper-slide">
                                2月
                            </div>
                            <div class="swiper-slide">
                                3月
                            </div>
                            <div class="swiper-slide">
                                4月
                            </div>
                            <div class="swiper-slide">
                                5月
                            </div>
                            <div class="swiper-slide">
                                6月
                            </div>
                            <div class="swiper-slide">
                                7月
                            </div>
                            <div class="swiper-slide">
                                8月
                            </div>
                            <div class="swiper-slide">
                                9月
                            </div>
                            <div class="swiper-slide">
                                10月
                            </div>
                            <div class="swiper-slide">
                                11月
                            </div>
                            <div class="swiper-slide">
                                12月
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tc-bot">
                <div class="tc-bot-left">
                    回到今天
                </div>
                <div class="tc-bot-right">
                    确定
                </div>
                <i></i>
            </div>
        </div>
    </section>
</body>
<script src="../../../script/api.js"></script>
<script src="../../../script/zepto.min.js"></script>
<script src="../../../script/doT.min.js"></script>
<script src="../../../script/swiper.min.js"></script>
<script src="lib/js/calendar.js"></script>
<script>
    //全局的年月日，适用于任何时候获取今天的年月日。
    var sev_m, sev_y, sev_d, active = 3;
    var mySwiper = new Swiper('.swiper-container', {
        initialSlide: 1,
        loop: true,
        speed: 400,
        followFinger: false,
        prevButton: '.js_prev',
        nextButton: '.js_next',
        onSlideChangeStart: function(swiper) {
            swiper.lockSwipes();
        },
        onSlideChangeEnd: function(swiper) {
            Zepto(function($) {
                var nows = $(".swiper-slide-active").find("table").attr("id");
                if (nows == 'now2')
                    return;
                nows = parseInt(nows.substr(1, 1));
                //console.log(active,nows);
                if (nows == active)
                    return;
                if (active == 4 && nows == 5) {
                    var fors = 1;
                    sev_m++;
                    if (sev_m > 12) {
                        sev_m = 1;
                        sev_y++;
                    }
                    var nowweak = new Date(sev_y, sev_m - 1, 1).getDay();
                    get_first(nowweak, sev_y, sev_m, 0, "d2");
                    var lastm = sev_m - 1;
                    var lasty = sev_y;
                    if (lastm < 1) {
                        lastm = 12;
                        lasty--;
                    }
                    var nm = sev_m + 1;
                    var ny = sev_y;
                    if (nm > 12) {
                        nm = 1;
                        ny++;
                    }
                    var nowweak = new Date(ny, nm - 1, 1).getDay();
                    var lastweek = new Date(lasty, lastm - 1, 1).getDay();
                    get_first(lastweek, lasty, lastm, 0, "d" + fors);
                    get_first(nowweak, ny, nm, 0, "d3");
                    $("#ymym").html(sev_y + "年" + sev_m + "月");
                    active = 5;
                } else if (active == 2 && nows == 1) {
                    var fors = 5;
                    var nextweak = new Date(sev_y, sev_m - 1, 1).getDay();
                    get_first(nextweak, sev_y, sev_m, 0, "d" + fors);
                    sev_m--;
                    if (sev_m < 1) {
                        sev_m = 12;
                        sev_y--;
                    }
                    var nowweak = new Date(sev_y, sev_m - 1, 1).getDay();
                    get_first(nowweak, sev_y, sev_m, 0, "d4");
                    var nm = sev_m - 1;
                    var ny = sev_y;
                    if (nm < 1) {
                        nm = 12;
                        ny--;
                    }
                    var nowweak = new Date(ny, nm - 1, 1).getDay();
                    //get_first(nowweak, ny, nm, 0, "d4");
                    get_first(nowweak, ny, nm, 0, "d3");
                    $("#ymym").html(sev_y + "年" + sev_m + "月");
                    active = 1;
                } else if (active == 5 && nows == 3) {
                    var fors = 4;
                    var lastm = sev_m;
                    var lasty = sev_y;
                    sev_m++;
                    if (sev_m > 12) {
                        sev_m = 1;
                        sev_y++;
                    }
                    var nm = sev_m + 1;
                    var ny = sev_y;
                    if (nm > 12) {
                        nm = 1;
                        ny++;
                    }
                    var nowweak = new Date(ny, nm - 1, 1).getDay();
                    get_first(nowweak, ny, nm, 0, "d" + fors);
                    var nowweak = new Date(lasty, lastm - 1, 1).getDay();
                    get_first(nowweak, lasty, lastm, 0, "d2");
                    $("#ymym").html(sev_y + "年" + sev_m + "月");
                    active = 3;
                } else if (active == 1 && nows == 3) {
                    var fors = 2;
                    var lastm = sev_m;
                    var lasty = sev_y;
                    sev_m--;
                    if (sev_m < 1) {
                        sev_m = 12;
                        sev_y--;
                    }
                    var nm = sev_m - 1;
                    var ny = sev_y;
                    if (nm < 1) {
                        nm = 12;
                        ny--;
                    }
                    var nowweak = new Date(ny, nm - 1, 1).getDay();
                    get_first(nowweak, ny, nm, 0, "d" + fors);
                    var nowweak = new Date(lasty, lastm - 1, 1).getDay();
                    get_first(nowweak, lasty, lastm, 0, "d4");
                    $("#ymym").html(sev_y + "年" + sev_m + "月");
                    active = 3;
                } else if (active == 1 && nows == 5) {
                    var fors = 3;
                    var lastm = sev_m;
                    var lasty = sev_y;
                    sev_m++;
                    if (sev_m > 12) {
                        sev_m = 1;
                        sev_y++;
                    }
                    var nm = sev_m + 1;
                    var ny = sev_y;
                    if (nm > 12) {
                        nm = 1;
                        ny++;
                    }
                    var nowweak = new Date(ny, nm - 1, 1).getDay();
                    get_first(nowweak, ny, nm, 0, "d" + fors);
                    $("#ymym").html(sev_y + "年" + sev_m + "月");
                    active = 5;
                } else if (active == 5 && nows == 1) {
                    var fors = 3;
                    sev_m--;
                    if (sev_m < 1) {
                        sev_m = 12;
                        sev_y--;
                    }
                    var lastm = sev_m;
                    var lasty = sev_y;
                    var nm = sev_m - 1;
                    var ny = sev_y;
                    if (nm < 1) {
                        nm = 12;
                        ny--;
                    }
                    var nowweak = new Date(ny, nm - 1, 1).getDay();
                    var lastweak = new Date(lasty, sev_m - 1, 1).getDay();
                    get_first(nowweak, ny, nm, 0, "d" + fors);
                    // console.log(lasty, lastm)
                    get_first(lastweak, lasty, sev_m, 0, "d4");
                    $("#ymym").html(sev_y + "年" + sev_m + "月");
                    active = 1;
                } else if (active > nows) {
                    var fors = nows - 1;
                    if (fors < 1)
                        fors = 5;
                    sev_m--;
                    if (sev_m < 1) {
                        sev_m = 12;
                        sev_y--;
                    }
                    var nm = sev_m - 1;
                    var ny = sev_y;
                    if (nm < 1) {
                        nm = 12;
                        ny--;
                    }
                    var nowweak = new Date(ny, nm - 1, 1).getDay();
                    get_first(nowweak, ny, nm, 0, "d" + fors);
                    $("#ymym").html(sev_y + "年" + sev_m + "月");
                    active = nows;
                } else if (active < nows) {
                    var fors = nows + 1;
                    if (fors > 5)
                        fors = 1;
                    sev_m++;
                    if (sev_m > 12) {
                        sev_m = 1;
                        sev_y++;
                    }
                    var nm = sev_m + 1;
                    var ny = sev_y;
                    if (nm > 12) {
                        nm = 1;
                        ny++;
                    }
                    var nowweak = new Date(ny, nm - 1, 1).getDay();
                    get_first(nowweak, ny, nm, 0, "d" + fors);
                    $("#ymym").html(sev_y + "年" + sev_m + "月");
                    active = nows;
                }
                var trLength = $("#d" + nows).find("tr").length;
                if (trLength == 6) {
                    $(".swiper-container").css("paddingBottom", ".45rem");
                } else {
                    $(".swiper-container").css("paddingBottom", "");
                }
                swiper.unlockSwipes();
            });
        }
    });

    apiready = function() {
        Zepto(function($) {
            api.parseTapmode();
            var dataArr1 = new Array();
            for (var i = 1900; i < 2049; i++) {
                dataArr1[(i - 1900)] = i;
            }
            var dataArr = {
                "array": dataArr1
            };
            var arrText = doT.template($("#arraystmpl").text());
            $("#arrays").html(arrText(dataArr));
        });
    }

    function show() {
        if (!$api.hasCls($api.byId('dis'), 'display')) {
            $api.addCls($api.byId('dis'), "display");
        }
    }

    function search() {
        if ($api.hasCls($api.byId('dis'), 'display')) {
            $api.removeCls($api.byId('dis'), "display");
            var date1 = $api.text($api.byId('ymym'));
            date1 = date1.replace(/年/ig, "-");
            date1 = date1.replace(/月/ig, "-");
            date1 = date1 + $api.text($api.byId('top_shu'));
            api.ajax({
                url: 'http://v.juhe.cn/calendar/day?date=' + date1 + '&key=7339d3eb8819aa02ed12ae1547f59df9',
                method: 'get',
                cache: 'true',
            }, function(ret, err) {
                if (ret) {
                    if (ret.error_code == '0') {
                        if (ret.result.data.suit)
                            $api.html($api.byId('suit'), '宜:<br/>' + ret.result.data.suit)
                        else
                            $api.html($api.byId('suit'), '宜:<br/>无');
                        if (ret.result.data.avoid)
                            $api.html($api.byId('avoid'), '忌:<br/>' + ret.result.data.avoid)
                        else
                            $api.html($api.byId('avoid'), '忌:<br/>无');
                        $api.html($api.byId('lunarYear'), '' + ret.result.data.lunarYear);
                        $api.html($api.byId('animalsYear'), '' + ret.result.data.animalsYear);
                        if (ret.result.data.holiday)
                            $api.html($api.byId('holiday'), '' + ret.result.data.holiday)
                        else
                            $api.html($api.byId('holiday'), '');
                    } else
                        alert(JSON.stringify(ret));
                } else {
                    alert(JSON.stringify(err));
                }
            });
        } else {
            $api.addCls($api.byId('dis'), "display");
        }
    }

    var yl = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
    window.onload = function() {
        Zepto(function($) {
            $("#now3").attr("id", "d1");
            $("#now1").attr("id", "d2");
            $("#now2").attr("id", "d3");
            $("#now3").attr("id", "d4");
            $("#now1").attr("id", "d5");
            var globledate = new Date();
            var y = globledate.getFullYear();
            var m = globledate.getMonth() + 1;
            var d = globledate.getDate();
            sev_m = m;
            sev_y = y;
            sev_d = d;
            var nowweak = new Date(y, m - 1, 1).getDay();
            if (nowweak == 7)
                nowweak = 0;
            get_first(nowweak, y, m, d, "d3");
            set_top(0);
            m = m + 1;
            if (m > 12) {
                m = 1;
                y += 1;
            }
            nowweak = new Date(y, m - 1, 1).getDay();
            get_first(nowweak, y, m, 0, "d4");
            m = sev_m - 1;
            if (m < 1) {
                m = 12;
                y = sev_y - 1;
            }
            nowweak = new Date(y, m - 1, 1).getDay();
            get_first(nowweak, y, m, 0, "d2");
            $("#ymym").html(sev_y + "年" + sev_m + "月");
            $(".js_jin").click(function() {
                active = 3;
                var globledate = new Date();
                var y = globledate.getFullYear();
                var m = globledate.getMonth() + 1;
                var d = globledate.getDate();
                sev_m = m;
                sev_y = y;
                sev_d = d;
                var nowweak = new Date(y, m - 1, 1).getDay();
                if (nowweak == 7)
                    nowweak = 0;
                get_first(nowweak, y, m, d, "d3");
                set_top(0);
                m = m + 1;
                if (m > 12) {
                    m = 1;
                    y += 1;
                }
                nowweak = new Date(y, m - 1, 1).getDay();
                get_first(nowweak, y, m, 0, "d4");
                m = sev_m - 1;
                if (m < 1) {
                    m = 12;
                    y = sev_y - 1;
                }
                nowweak = new Date(y, m - 1, 1).getDay();
                get_first(nowweak, y, m, 0, "d2");
                $("#ymym").html(sev_y + "年" + sev_m + "月");
                mySwiper.slideTo(2, 500, false);
            });
            mySwiper.unlockSwipes();
        });
    };

    function jump(yyyy, mm, dd) {
        Zepto(function($) {
            sev_y = parseInt(yyyy);
            sev_m = parseInt(mm);
            sev_d = parseInt(dd);
            active = 3;
            var globledate = new Date(yyyy, parseInt(mm) - 1, parseInt(dd));
            //var nowweak = globledate.getDay();
            var y = globledate.getFullYear();
            var m = globledate.getMonth() + 1;
            var d = globledate.getDate();
            //console.log("globledate:",y,m,d);
            var sev_m_tmp = m;
            var sev_y_tmp = y;
            var sev_d_tmp = d;
            var nowweak = new Date(y, m - 1, 1).getDay();
            if (nowweak == 7)
                nowweak = 0;
            get_first(nowweak, y, m, d, "d3");
            //set_top(0);
            m = m + 1;
            if (m > 12) {
                m = 1;
                y += 1;
            }
            nowweak = new Date(y, m - 1, 1).getDay();
            get_first(nowweak, y, m, 0, "d4");
            m = sev_m - 1;
            if (m < 1) {
                m = 12;
                y = sev_y - 1;
            }
            nowweak = new Date(y, m - 1, 1).getDay();
            get_first(nowweak, y, m, 0, "d2");
            $("#ymym").html(sev_y + "年" + sev_m + "月");
            $(".covers").hide();
            mySwiper.slideTo(2, 500, false);
            click_sev();
        });
    }

    function click_sev() {
        Zepto(function($) {
            $("#d3").find("td").each(function() {
                if ($(this).attr("data_y") == sev_y && $(this).attr("data_m") == sev_m && $(this).attr("data_d") == sev_d) {
                    $(this).click();
                }
            });
        });
    }

    function get_first(a, b, c, d, e) {
        var str = '<tr>';
        if ((c - 2) < 0) {
            var ldays = 31;
            var lm = 12;
            var lb = b - 1;
        } else {
            var ldays = yl[c - 2];
            var lm = c - 1;
            var lb = b;
        }
        if (c == 12) {
            var xdays = 31;
            var xm = 1;
            var xb = b + 1;
        } else {
            var xdays = yl[c];
            var xm = c + 1;
            var xb = b;
        }
        if (ldays == 28) {
            if ((lb % 4 == 0 && lb % 100 != 0) || (lb % 100 == 0 && lb % 400 == 0)) {
                ldays = 29;
            }
        }
        if (xdays == 28) {
            if ((xb % 4 == 0 && xb % 100 != 0) || (xb % 100 == 0 && xb % 400 == 0)) {
                xdays = 29;
            }
        }
        var dd;
        if (yl[c - 1] == 28) {
            if ((b % 4 == 0 && b % 100 != 0) || (b % 100 == 0 && b % 400 == 0)) {
                dd = 29;
            } else {
                dd = 28;
            }
        } else {
            dd = yl[c - 1];
        }
        var num = 1;
        for (var i = a; i > 0; i--) {
            var bday = ldays - i + 1;
            var ly = LunarDate.GetLunarDayDetail(lb, lm, bday);
            var jq = getjq(lb, lm, bday);
            var jr = getjr(lb, lm, bday);
            if (jq) {
                ly = '<font color="#FF8C2E">' + jq;
                if (jr) {
                    ly = ly + '(' + jr + ')';
                }
            } else if (jr) {
                ly = '<font color="#FF8C2E">' + jr;
            }
            var jd = "";
            var hb = lb + "-" + lm + "-" + bday;
            str += ' <td data_y="' + lb + '" data_m="' + lm + '" data_d="' + bday + '" class="list not_this js_up"><i>' + bday + '</i><em>' + ly + '</em>' + jd + '</td>';
            if (num % 7 == 0) {
                str += '</tr><tr>';
            }
            num++;
        }
        for (var i = 1; i <= dd; i++) {
            var bday = ldays - i + 1;
            var ly = LunarDate.GetLunarDayDetail(b, c, i);
            var jq = getjq(b, c, i);
            var jr = getjr(b, c, i);
            if (jq) {
                ly = '<font color="#FF8C2E">' + jq;
                if (jr) {
                    ly = ly + '(' + jr + ')';
                }
            } else if (jr) {
                ly = '<font color="#FF8C2E">' + jr;
            }
            var jd = "";
            var hb = b + "-" + c + "-" + i;
            if (new Date().getDate() == i && b == new Date().getFullYear() && c == (new Date().getMonth() + 1)) {
                str += ' <td data_y="' + b + '" data_m="' + c + '" data_d="' + i + '" class="list today"><i>' + i + '</i><em>' + ly + '</em>' + jd + '</td>';
            } else {
                str += ' <td data_y="' + b + '" data_m="' + c + '" data_d="' + i + '" class="list"><i>' + i + '</i><em>' + ly + '</em>' + jd + '</td>';
            }
            if (num % 7 == 0) {
                str += '</tr><tr>';
            }
            num++;
        }
        var last = 42 - a - dd;
        if (last > 6) {
            last = last - 7;
        }
        for (var i = 1; i <= last; i++) {
            var ly = LunarDate.GetLunarDayDetail(xb, xm, i);
            var jq = getjq(xb, xm, i);
            var jr = getjr(xb, xm, i);
            if (jq) {
                ly = '<font color="#FF8C2E">' + jq;
                if (jr) {
                    ly = ly + '(' + jr + ')';
                }
            } else if (jr) {
                ly = '<font color="#FF8C2E">' + jr;
            }

            var jd = "";
            var hb = xb + "-" + xm + "-" + i;
            str += ' <td data_y="' + xb + '" data_m="' + xm + '" data_d="' + i + '" class="list not_this js_down"><i>' + i + '</i><em>' + ly + '</em>' + jd + '</td>';
            if (num % 7 == 0) {
                str += '</tr><tr>';
            }
            num++;
        }
        if (str.substring(str.length - 4, str.length) == "<tr>") {
            str = str.substring(0, str.length - 4);
        }
        document.getElementById(e).innerHTML = str;
        bind_click(e);
    }

    function bind_click(a) {
        Zepto(function($) {
            $("#" + a).find("td").unbind("click");
            $("#" + a).find("td").each(function() {
                if ($(this).hasClass('not_this')) {
                    $(this).click(function() {
                        jump($(this).attr('data_y'), $(this).attr('data_m'), $(this).attr('data_d'));
                    });
                } else {
                    $(this).click(function() {
                        set_top($(this));
                    });
                }
            });
        });
    }

    function set_top(a) {
        if (!a) {
            var weeks = ['星期一', '星期二', '星期三', '星期四', '星期五', '星期六', '星期日'];
            var data = new Date();
            var weekday = 0;
            if (data.getDay() == 0) {
                weekday = data.getDay() + 6;
            } else {
                weekday = data.getDay() - 1;
            }
            var weekk = weeks[weekday];
            var yue = LunarDate.GetLunarDay(data.getFullYear(), data.getMonth() + 1, data.getDate());
            var shu = data.getDate();
            document.getElementById("top_shu").innerHTML = shu;
            sev_d = parseInt(shu);
            document.getElementById("top_week").innerHTML = weekk;
            document.getElementById("top_yue").innerHTML = yue;
        } else {
            var weeks = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
            var y = a.attr("data_y");
            var m = parseInt(a.attr("data_m")) - 1;
            if (m < 0)
                m = 11;
            var d = parseInt(a.attr("data_d"));
            var weekk = weeks[new Date(y, m, d).getDay()];
            var ms = parseInt(a.attr("data_m"));
            var yue = LunarDate.GetLunarDay(y, ms, d);
            document.getElementById("top_shu").innerHTML = d;
            sev_d = parseInt(d);
            document.getElementById("top_week").innerHTML = weekk;
            document.getElementById("top_yue").innerHTML = yue;
            $(".xuanzhong").removeClass('xuanzhong');
            a.addClass("xuanzhong");
        }
        show();
    }

    var LunarDate = {
        madd: new Array(0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334),
        HsString: '甲乙丙丁戊己庚辛壬癸',
        EbString: '子丑寅卯辰巳午未申酉戌亥',
        NumString: "一二三四五六七八九十",
        MonString: "正二三四五六七八九十冬腊",
        CalendarData: new Array(0xA4B, 0x5164B, 0x6A5, 0x6D4, 0x415B5, 0x2B6, 0x957, 0x2092F, 0x497, 0x60C96, 0xD4A, 0xEA5, 0x50DA9, 0x5AD, 0x2B6, 0x3126E, 0x92E, 0x7192D, 0xC95, 0xD4A, 0x61B4A, 0xB55, 0x56A, 0x4155B, 0x25D, 0x92D, 0x2192B,
            0xA95, 0x71695, 0x6CA, 0xB55, 0x50AB5, 0x4DA, 0xA5B, 0x30A57, 0x52B, 0x8152A, 0xE95, 0x6AA, 0x615AA, 0xAB5, 0x4B6, 0x414AE, 0xA57, 0x526, 0x31D26, 0xD95, 0x70B55, 0x56A, 0x96D, 0x5095D, 0x4AD, 0xA4D, 0x41A4D, 0xD25, 0x81AA5,
            0xB54, 0xB6A, 0x612DA, 0x95B, 0x49B, 0x41497, 0xA4B, 0xA164B, 0x6A5, 0x6D4, 0x615B4, 0xAB6, 0x957, 0x5092F, 0x497, 0x64B, 0x30D4A, 0xEA5, 0x80D65, 0x5AC, 0xAB6, 0x5126D, 0x92E, 0xC96, 0x41A95, 0xD4A, 0xDA5, 0x20B55, 0x56A,
            0x7155B, 0x25D, 0x92D, 0x5192B, 0xA95, 0xB4A, 0x416AA, 0xAD5, 0x90AB5, 0x4BA, 0xA5B, 0x60A57, 0x52B, 0xA93, 0x40E95),
        Year: null,
        Month: null,
        Day: null,
        TheDate: null,
        GetBit: function(m, n) {
            return (m >> n) & 1;
        },
        e2c: function() {
            this.TheDate = (arguments.length != 3) ? new Date() : new Date(arguments[0], arguments[1], arguments[2]);
            var total, m, n, k;
            var isEnd = false;
            var tmp = this.TheDate.getFullYear();
            total = (tmp - 1921) * 365 + Math.floor((tmp - 1921) / 4) + this.madd[this.TheDate.getMonth()] + this.TheDate.getDate() - 38;
            if (this.TheDate.getYear() % 4 == 0 && this.TheDate.getMonth() > 1) {
                total++;
            }
            for (m = 0;; m++) {
                k = (this.CalendarData[m] < 0xfff) ? 11 : 12;
                for (n = k; n >= 0; n--) {
                    if (total <= 29 + this.GetBit(this.CalendarData[m], n)) {
                        isEnd = true;
                        break;
                    }
                    total = total - 29 - this.GetBit(this.CalendarData[m], n);
                }
                if (isEnd)
                    break;
            }
            this.Year = 1921 + m;
            this.Month = k - n + 1;
            this.Day = total;
            if (k == 12) {
                if (this.Month == Math.floor(this.CalendarData[m] / 0x10000) + 1) {
                    this.Month = 1 - this.Month;
                }
                if (this.Month > Math.floor(this.CalendarData[m] / 0x10000) + 1) {
                    this.Month--;
                }
            }
        },
        GetcDateString: function(tip) {
            if (tip == 1) {
                var ts = (this.Day < 11) ? "初" : ((this.Day < 20) ? "十" : ((this.Day < 30) ? "二十" : "三十"));
                if (this.Day % 10 != 0 || this.Day == 10) {
                    ts += this.NumString.charAt((this.Day - 1) % 10);
                }
                return ts;
            }
            var tmp = "";
            // tmp += this.HsString.charAt((this.Year - 4) % 10);
            // tmp += this.EbString.charAt((this.Year - 4) % 12);
            // tmp += "年 ";
            if (this.Month < 1) {
                //tmp += "(闰)";
                tmp += this.MonString.charAt(-this.Month - 1);
            } else {
                tmp += this.MonString.charAt(this.Month - 1);
            }
            tmp += "月";
            tmp += (this.Day < 11) ? "初" : ((this.Day < 20) ? "十" : ((this.Day < 30) ? "二十" : "三十"));
            if (this.Day % 10 != 0 || this.Day == 10) {
                tmp += this.NumString.charAt((this.Day - 1) % 10);
            }
            return tmp;
        },
        GetLunarDay: function(solarYear, solarMonth, solarDay) {
            if (solarYear < 1900 || solarYear > 2049) {
                return "";
            } else {
                solarMonth = (parseInt(solarMonth) > 0) ? (solarMonth - 1) : 11;
                this.e2c(solarYear, solarMonth, solarDay);
                return this.GetcDateString(0);
            }
        },
        GetLunarDayDetail: function(solarYear, solarMonth, solarDay) {
            if (solarYear < 1900 || solarYear > 2049) {
                return "";
            } else {
                solarMonth = (parseInt(solarMonth) > 0) ? (solarMonth - 1) : 11;
                this.e2c(solarYear, solarMonth, solarDay);
                return this.GetcDateString(1);
            }
        }
    };

    function getjr(yyyy, mm, dd) {
        if (mm == 1 && dd == 1) {
            return "元旦";
        } else if (mm == 2 && dd == 14) {
            return "情人节";
        } else if (mm == 3 && dd == 8) {
            return "妇女节";
        } else if (mm == 3 && dd == 12) {
            return "植树节";
        } else if (mm == 3 && dd == 18) {
            return "作者生日";
        } else if (mm == 4 && dd == 1) {
            return "愚人节";
        } else if (mm == 5 && dd == 1) {
            return "劳动节";
        } else if (mm == 5 && dd == 4) {
            return "青年节";
        } else if (mm == 5 && dd == 12) {
            return "护士节";
        } else if (mm == 5 && dd == 31) {
            return "无烟日";
        } else if (mm == 6 && dd == 1) {
            return "儿童节";
        } else if (mm == 6 && dd == 1) {
            return "世界环境日";
        } else if (mm == 7 && dd == 1) {
            return "建党节";
        } else if (mm == 8 && dd == 1) {
            return "建军节";
        } else if (mm == 9 && dd == 10) {
            return "教师节";
        } else if (mm == 10 && dd == 1) {
            return "国庆节";
        } else if (mm == 10 && dd == 24) {
            return "程序员节";
        } else if (mm == 11 && dd == 1) {
            return "万圣节";
        } else if (mm == 11 && dd == 11) {
            return "光棍节";
        } else if (mm == 12 && dd == 24) {
            return "平安夜";
        } else if (mm == 12 && dd == 25) {
            return "圣诞节";
        } else if (LunarDate.GetLunarDay(yyyy, mm, dd) == '正月初一') {
            return "春节";
        } else if (LunarDate.GetLunarDay(yyyy, mm, dd) == '正月十五') {
            return "元宵节";
        } else if (LunarDate.GetLunarDay(yyyy, mm, dd) == '五月初五') {
            return "端午节";
        } else if (LunarDate.GetLunarDay(yyyy, mm, dd) == '七月初七') {
            return "七夕节";
        } else if (LunarDate.GetLunarDay(yyyy, mm, dd) == '八月十五') {
            return "中秋节";
        } else if (LunarDate.GetLunarDay(yyyy, mm, dd) == '九月初九') {
            return "重阳节";
        } else if (LunarDate.GetLunarDay(yyyy, mm, dd) == '腊月初八') {
            return "腊八节";
        } else if (LunarDate.GetLunarDay(yyyy, mm, dd) == '腊月二十四') {
            return "传统扫房日";
        } else if (LunarDate.GetLunarDay(yyyy, mm, dd + 1) == '正月初一') {
            return "除夕";
        } else {
            return "";
        }
    };

    function getjq(yyyy, mm, dd) {
        if (yyyy == 2016 && mm == 12 && dd == 7) {
            return "大雪";
        }
        if (yyyy == 2016 && mm == 12 && dd == 6) {
            return "";
        }
        mm = mm - 1;
        var sTermInfo = new Array(0, 21208, 42467, 63836, 85337, 107014, 128867, 150921, 173149, 195551, 218072, 240693, 263343, 285989, 308563, 331033, 353350, 375494, 397447, 419210, 440795, 462224, 483532, 504758);
        var solarTerm = new Array("小寒", "大寒", "立春", "雨水", "惊蛰", "春分", "清明", "谷雨", "立夏", "小满", "芒种", "夏至", "小暑", "大暑", "立秋", "处暑", "白露", "秋分", "寒露", "霜降", "立冬", "小雪", "大雪", "冬至");
        var tmp1 = new Date((31556925974.7 * (yyyy - 1900) + sTermInfo[mm * 2 + 1] * 60000) + Date.UTC(1900, 0, 6, 2, 5));
        var tmp2 = tmp1.getUTCDate();
        var solarTerms = "";
        if (tmp2 == dd)
            solarTerms = solarTerm[mm * 2 + 1];
        tmp1 = new Date((31556925974.7 * (yyyy - 1900) + sTermInfo[mm * 2] * 60000) + Date.UTC(1900, 0, 6, 2, 5));
        tmp2 = tmp1.getUTCDate();
        if (tmp2 == dd)
            solarTerms = solarTerm[mm * 2];
        return solarTerms;
    }

    Zepto(function($) {
        $(function() {
            $(".prorup").on("click", function() {
                $(".prorup").hide();
                $(".jie").hide();
                $(".layer").hide();
            });
            $(".jqclass").click(function() {
                var riziss = $(this).attr('data');
                var srt = riziss.split("-");
                $(".prorup").hide();
                $(".layer").hide();
                jump(srt[0], srt[1], srt[2]);
                $(".jie").hide();
            });
        });
        $('.date').on('click', function() {
            $('.tc').show();
            $('.tc-innner').show();
            tc();
        });
    });
    var e = 1;

    function tc() {
        Zepto(function($) {
            var b, c, d;
            var myDate = new Date();
            if (e == 0) {
                b = myDate.getFullYear() - 1900;
                c = myDate.getMonth();
                d = myDate.getDate() - 1;
            } else {
                b = sev_y - 1900;
                c = sev_m - 1;
                d = sev_d - 1;
            }
            e = 1;
            var mySwiper = new Swiper('.swiper-container2', {
                direction: 'vertical',
                initialSlide: b,
                slidesPerView: 'auto',
                roundLengths: true,
                centeredSlides: true,
                watchSlidesProgress: true,
                watchSlidesVisibility: true,
                freeMode: true,
                freeModeMomentumRatio: 1,
                freeModeSticky: true,
                onTouchMove: function(swiper) {
                    var b1 = $('.year').children('.swiper-slide-active').html();
                    $('.i-year').html(b1);
                },
                onSlideChangeEnd: function(swiper) {
                    var b1 = $('.year').children('.swiper-slide-active').html();
                    $('.i-year').html(b1);
                },
            });
            var mySwiper = new Swiper('.swiper-container3', {
                direction: 'vertical',
                initialSlide: c,
                slidesPerView: 'auto',
                roundLengths: true,
                centeredSlides: true,
                watchSlidesProgress: true,
                watchSlidesVisibility: true,
                freeMode: true,
                freeModeMomentumRatio: 1,
                freeModeSticky: true,
                onTouchMove: function(swiper) {
                    var b1 = $('.month').children('.swiper-slide-active').html();
                    $('.i-month').html(b1);
                },
                onSlideChangeEnd: function(swiper) {
                    var b1 = $('.month').children('.swiper-slide-active').html();
                    $('.i-month').html(b1);
                },
            });
        });
    };
    Zepto(function($) {
        $('.tc-bot-left').click(function() {
            e = 0;
            tc();
        });
        $('.tc-bot-right').click(function() {
            $('.tc').hide();
            $('.tc-innner').hide();
            var yyyy = parseInt($('.year').children('.swiper-slide-active').html());
            var mm = parseInt($('.month').children('.swiper-slide-active').html());
            if (mm != sev_m || yyyy != sev_y) {
                jump(yyyy, mm, '1');
            };
        });
        $(".tc").on("click", function() {
            $(".tc-innner").hide();
            $(this).hide();
        });
    });
</script>

</html>
